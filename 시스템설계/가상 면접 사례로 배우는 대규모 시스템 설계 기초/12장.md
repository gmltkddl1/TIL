# 채팅 시스템
- 유저간의 채팅 구현시 메세지 발송은 http로 구현이 가능하나 메세지 수신은 다른 방식이 필요
- 클라이언트가 서버로 부터 메세지 수신여부를 확인하는 법
  - polling
  - 웹소켓
- 이중 polling은 서버 자원 낭비가 심함
- 웹소켓으로 연결을 유지하며 메세지 발송 수신하는게 유리
- 로그인 시에 특정 채팅서버와의 연결을 생성한다 (service discovery 활용)
## 1대1 채팅
- 메세지 전송시에 메세지 동기화 큐에 메세지를 집어 넣는다
- 동기화 큐에서는 수신자가 연결된 서버를 저장소에서 찾아서 해당 서버로 요청을 보낸다
- 연결되어있지 않다면 푸쉬 메세지를 보낸다
## 그룹채팅
- 그룹 채팅에 경우 메세지를 보내면 여러명이 수신해야함
- fan out on write
  - 쓰기 시에 수신자들의 메세지 큐에 메세지를 넣어줌
  - 소규모에 적합
- fan out on read
  - 수신자가 메세지를 읽을때 발신자의 큐에서 가져감
  - 대규모에 적합
## 접속 상태 확인
- 로그인시 캐시의 접속상태 갱신
- 로그아웃시 캐시 삭제
- 주기적으로 하트비트 통신하여 일정 기준 이상 실패하면 접속상태 변경
- 나와 친구인 유저에게 상태 전파 (fan out on write/read 선택)
