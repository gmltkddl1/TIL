# 사용자 수에 따른 규모의 확장성
- 단일 서버부터 시작하여 점진적으로 확장해 나가는 것

1. 단일서버
- 웹서버, DB, 캐시 서버 등이 하나에 서버에 존재
- 유저가 아주 적고 초창기에 사용 가능
2. DB, 웹 어플리케이션 분리
- 사용자가 어느정도 많아서지면 분리 필요
- 각각 독립적으로 규모 확장이 가능해진다
3. 웹 애플리케이션 계층 다중화
- 사용자가 많아지면 scale up(서버 스펙 올리기), scale out(동일 서버 추가 생성) 중 선택 가능
- scale up은 확장에 한계가있고 spof 문제가 있어 주로 scale out을 사용
- scale out시 여러 대의 서버의 부하를 분산하고 하나의 서버에 접속하는 것처럼 처리하기 위해 로드밸런서가 필요하다.
- 이렇게하면 사용자가 늘어나도 서버별로 적절히 부하를 분산할수 있고 특정 서버가 장애가 나도 다른 서버로 트래픽이 전달되므로 spof를 피할수 있다.
4. 데이터 베이스 계층 다중화
- 주-부 데이터베이스 모델을 사용한다
- 주 데이터 베이스는 읽기와 쓰기가 모두 가능하고 부 데이터 베이스는 읽기만 가능하다
- 주 데이터 베이스는 원본 부 데이터 베이스는 사본이다.
- 읽기 쓰기가 분리되어 성능이 향상되고 여러 데이터 존에 분리가 가능해져 안정성이 확보된다.
- 주 데이터 베이스 장애시 부 데이터 베이스 중 하나를 주 데이터 베이스로 변경 후 신규 부 데이터 베이스 생성
- 부 데이터 베이스 장애시 주 데이터베이스 혹은 부데이터 베이스에서 읽기 처리 후 신규 생성
- 위 방식으로 spof를 피할 수 잇다.
5. 캐시 계층 도입
- DB의 부하를 줄이고 서비스의 성능 향상을 위해 캐시 계층이 추가 가능
- 비싸거나 자주 사용되는 데이터를 메모리에 보관
- 캐시는 변경이 자주 일어나지 않는 데이터, 휘발되어도 상관없거나 원본을 DB에 저장한 데이터에 적용해야한다.
- 캐시 만료주기는 적절하게 설정해야한다. 너무 길면 신선도가 떨어지고 너무 짧으면 DB조회가 자주 일어난다.
- spof가 되지 않기 위해 다중화 필요
- 캐시 전략
  - cache aside
  - write through
  - write back
- 삭제 전략
  - LRU (Least recently used)
  - LFU (Least frequently used)
  - ttl
6. CDN
- CDN에 정적 컨텐츠를 캐시하면 성능향상이 가능
- 원본은 s3등에 저장하고 cdn에 없을 경우 저장소 조회 후 cdn에 캐싱
7. 무상태 서버
- 수평 확장을 쉽게하기 위해서는 서버를 무상태로 유지하는 것이 좋다
- 상태가 있다면 로드 밸런서의 sticky session 등을 이용해야하고 이는 로드밸런서 성능에도 좋지않고 확장시에도 좋지 않다.
8. 데이터 존 분리
- 데이터 센터가 spof가 되지 않게 여러 데이터 존에 분리하여 시스템을 구성해야한다.
9. 메세지 큐
- 메세지의 무손실을 보장하는 비동기 통신을 위한 요소이다
- 서버 간의 느슨한 결합을 위해 사용된다 (producer가 죽어도 consumer는 생산된 메세지를 소비, consumer가 죽어도 producer가 메세지 생산하는데 지장없음)
10. 로그 매트릭 수집
- 시스템이 복잡해지면 로그나 매트릭을 한곳에 모아 보는것이 중요해진다.
11. 데이터 베이스 확장
- 데이터 베이스도 수평 수직 확장이 가능하다 수직 확장은 한계가 있고 spof 문제가 있어 주로 수평확장 사용
- 수평확장은 샤딩이라고 불리고 이는 같은 스키마를 공유하지만 서로 데이터의 중복이 없는 것을 말한다
- 주로 키값의 해쉬를 이용하여 분배한다.
- 안정해쉬 등을 사용하면 서버 추가 제거에 유연하게 대응 가능
